<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>现代技能栈 – 网络篇</title><link>https://xiaoping378.github.io/docs/2-infra/network/</link><description>Recent content in 网络篇 on 现代技能栈</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Thu, 05 Jan 2017 00:00:00 +0000</lastBuildDate><atom:link href="https://xiaoping378.github.io/docs/2-infra/network/index.xml" rel="self" type="application/rss+xml"/><item><title>Docs: 内网机穿透开发</title><link>https://xiaoping378.github.io/docs/2-infra/network/frp/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://xiaoping378.github.io/docs/2-infra/network/frp/</guid><description>
&lt;div class="pageinfo pageinfo-primary">
&lt;p>充分利用外网开隧道代理到本地服务，演示或者内网开发的利器，自己具备公网服务器的可以使用frp，不具备的可以使用ngrok。&lt;/p>
&lt;/div>
&lt;h2 id="frp介绍">FRP介绍&lt;/h2>
&lt;p>frp 是国人开源的一种快速反向代理，可将 NAT 或防火墙后面的本地服务器暴露到互联网上。目前，它支持暴露 TCP 和 UDP，以及 HTTP 和 HTTPS 协议，也可以通过域名将请求转发到内部服务。&lt;/p>
&lt;p>&lt;img src="https://xiaoping378.github.io/images/frp-2022-03-06-20-21-49.png" alt="">&lt;/p>
&lt;h2 id="安装">安装&lt;/h2>
&lt;p>二进制下载&lt;a href="https://github.com/fatedier/frp/releases">地址&lt;/a>, 解压后内容如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">➜ frp_0.39.1_linux_amd64 tree
.
├── frpc
├── frpc_full.ini
├── frpc.ini
├── frps
├── frps_full.ini
├── frps.ini
├── LICENSE
└── systemd
├── frpc.service
├── frpc@.service
├── frps.service
└── frps@.service
&lt;span style="color:#666">1&lt;/span> directory, &lt;span style="color:#666">11&lt;/span> files
&lt;/code>&lt;/pre>&lt;/div>&lt;p>可将其中的 frpc 拷贝到内网服务所在的机器上，将 frps 拷贝到具有公网 IP 的机器上，放置在任意目录。&lt;/p>
&lt;p>后续使用思路：&lt;/p>
&lt;ul>
&lt;li>编写配置文件，先通过 ./frps -c ./frps.ini 启动服务端，&lt;/li>
&lt;li>再通过 ./frpc -c ./frpc.ini 启动客户端。&lt;/li>
&lt;li>如果需要在后台长期运行，可使用压缩包内写好的的systemd服务&lt;/li>
&lt;/ul>
&lt;h2 id="代理ssh">代理ssh&lt;/h2>
&lt;p>本人日常开发使用vsocde，众所周知，其&lt;a href="https://code.visualstudio.com/docs/remote/ssh">remote SSH开发&lt;/a>的特性非常惊艳，可以提供本地开发的体验，背后需要通过ssh连接到远端服务器，高配云主机价格不菲，公司电脑长期荒废中，，，，遂有了此想法，只购买一个低配的云主机用来代理到内网的公司电脑（已安装linux）上，然后利用vscode实现内网穿透开发。&lt;/p>
&lt;h3 id="服务端">服务端&lt;/h3>
&lt;p>外网云主机用作服务端的配置：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">➜ ~ cat /etc/frp/frps.ini
&lt;span style="color:#080;font-style:italic"># common为服务端基础配置&lt;/span>
&lt;span style="color:#666">[&lt;/span>common&lt;span style="color:#666">]&lt;/span>
&lt;span style="color:#080;font-style:italic"># 服务端监听的端口，用于和内网客户端建立通信，来接受需要代理服务的配置。&lt;/span>
&lt;span style="color:#b8860b">bind_port&lt;/span> &lt;span style="color:#666">=&lt;/span> &lt;span style="color:#666">7380&lt;/span>
&lt;span style="color:#080;font-style:italic"># 服务端与客户端建立连接的Token，两边保持一致即可&lt;/span>
&lt;span style="color:#b8860b">token&lt;/span> &lt;span style="color:#666">=&lt;/span> PassWord
&lt;span style="color:#080;font-style:italic"># 日志级别，默认的info，会打印很多被外网恶扫的连接信息&lt;/span>
&lt;span style="color:#b8860b">log_level&lt;/span> &lt;span style="color:#666">=&lt;/span> warn
&lt;/code>&lt;/pre>&lt;/div>&lt;p>启动：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">frps -c /etc/frp/frps.ini
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="客户端">客户端&lt;/h3>
&lt;p>内网本地linux上，编写客户端配置：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">&lt;span style="color:#080;font-style:italic"># common为客户端基础配置&lt;/span>
&lt;span style="color:#666">[&lt;/span>common&lt;span style="color:#666">]&lt;/span>
&lt;span style="color:#080;font-style:italic"># 上例服务端运行的外网IP&lt;/span>
&lt;span style="color:#b8860b">server_addr&lt;/span> &lt;span style="color:#666">=&lt;/span> 39.*.*.*
&lt;span style="color:#b8860b">server_port&lt;/span> &lt;span style="color:#666">=&lt;/span> &lt;span style="color:#666">7380&lt;/span>
&lt;span style="color:#b8860b">token&lt;/span> &lt;span style="color:#666">=&lt;/span> PassWord
&lt;span style="color:#080;font-style:italic"># 需要代理的服务配置，可以根绝自身情况开启多个代理服务如web、 后端api等。&lt;/span>
&lt;span style="color:#666">[&lt;/span>ssh&lt;span style="color:#666">]&lt;/span>
&lt;span style="color:#a2f">type&lt;/span> &lt;span style="color:#666">=&lt;/span> tcp
&lt;span style="color:#080;font-style:italic"># 本地服务信息&lt;/span>
&lt;span style="color:#b8860b">local_ip&lt;/span> &lt;span style="color:#666">=&lt;/span> 127.0.0.1
&lt;span style="color:#b8860b">local_port&lt;/span> &lt;span style="color:#666">=&lt;/span> &lt;span style="color:#666">22&lt;/span>
&lt;span style="color:#080;font-style:italic"># 配置服务端代理端口， remote 2222 -&amp;gt; local 22&lt;/span>
&lt;span style="color:#b8860b">remote_port&lt;/span> &lt;span style="color:#666">=&lt;/span> &lt;span style="color:#666">2222&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>启动：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">frpc -c ./frpc.ini
&lt;/code>&lt;/pre>&lt;/div>&lt;p>如上设置运行，可在任意机器上，通过 &lt;code>ssh -p 2222 root@39.*.*.*&lt;/code> 登录内网机器。&lt;/p>
&lt;h3 id="vscode连接">vscode连接&lt;/h3>
&lt;p>安装正常步骤添加远端SSH机器，即可。
&lt;img src="https://xiaoping378.github.io/images/frp-2022-03-06-21-22-51.png" alt="">&lt;/p>
&lt;h2 id="frp总结">FRP总结&lt;/h2>
&lt;p>frp还有很多其他安全、UI、负载均衡等方面的配置，可根据自身环境选择，服务端和客户端选项更全面的配置&lt;a href="https://gofrp.org/docs/reference/">见此&lt;/a>&lt;/p>
&lt;p>总体上使用frp代理简单的服务，配置上可以很简单，但要配置稍复杂的场景，目前的设计感觉有些缺陷，让人容易犯迷糊，比如设计多种端口字段，来开启某特性。&lt;/p>
&lt;h2 id="ngrok">ngrok&lt;/h2>
&lt;p>针对个人免费的SaaS服务，需要注册账号，下载客户端，利用分配的token，发起链接，即可通过外网访问本地服务，具体操作步骤如下：&lt;/p>
&lt;ol>
&lt;li>进入ngrok官网（https://ngrok.com/），注册ngrok账号并下载ngrok；&lt;/li>
&lt;li>根据官网给定的授权码，运行如下授权命令，会保存到在本地HOME目录&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code>ngrok authtoken 2689y3MT2qsAois0MG****
&lt;/code>&lt;/pre>&lt;ol start="3">
&lt;li>发起本地服务1080端口的代理&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-bash" data-lang="bash">ngrok http &lt;span style="color:#666">1080&lt;/span> &amp;amp;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>如上执行，可通过红色框访问本地1080端口服务，如果是要代理SSH的话，需要执行&lt;code>ngrok tcp 22 &amp;amp;&lt;/code>。
&lt;img src="https://xiaoping378.github.io/images/frp-2022-03-09-21-51-39.png" alt="">&lt;/p>
&lt;p>值得注意的是，每次运行命令都会重新生成新的域名地址，要想固定域名的话，需要付费。&lt;/p>
&lt;h2 id="总结">总结&lt;/h2>
&lt;p>目前个人使用的方式，是利用frp建立ssh隧道，日常vscode远程开发，需要访问临时启动的服务的时候，利用ngrok随手启动即可访问到。&lt;/p></description></item><item><title>Docs: 网络TCP/IP协议栈</title><link>https://xiaoping378.github.io/docs/2-infra/network/tcpip/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://xiaoping378.github.io/docs/2-infra/network/tcpip/</guid><description>
&lt;p>.TODO&lt;/p></description></item><item><title>Docs: 混合云网络SDN</title><link>https://xiaoping378.github.io/docs/2-infra/network/%E6%B7%B7%E5%90%88%E4%BA%91sdn%E9%80%89%E5%9E%8B/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://xiaoping378.github.io/docs/2-infra/network/%E6%B7%B7%E5%90%88%E4%BA%91sdn%E9%80%89%E5%9E%8B/</guid><description>
&lt;ul>
&lt;li>TODO.&lt;/li>
&lt;/ul>
&lt;h3 id="为什么需要sdn">为什么需要SDN&lt;/h3>
&lt;ul>
&lt;li>网络可编程&lt;/li>
&lt;li>VPC（Virtual Private Cloud）&lt;/li>
&lt;/ul>
&lt;h3 id="现有sdn方案">现有SDN方案&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>硬件方案（软件定义，硬件实现）&lt;/p>
&lt;ul>
&lt;li>主流网络设备厂商有各自实现&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>软件方案（NFV）&lt;/p>
&lt;ul>
&lt;li>VMWare NSX, Juniper OpenContrail, OpenStack DVR...&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="业务需求">业务需求&lt;/h3>
&lt;ul>
&lt;li>用户网络隔离 - 多租户&lt;/li>
&lt;li>保证中等流量规模的高性能低延迟&lt;/li>
&lt;li>适应复杂异构的基础架构（混合云-- kubernetes，虚机，裸机）&lt;/li>
&lt;li>端点迁移，IP不变&lt;/li>
&lt;li>负载均衡（L2/L3）&lt;/li>
&lt;li>端到端流量精细ACL&lt;/li>
&lt;li>可API控制&lt;/li>
&lt;li>运维监控（包，字节流）&lt;/li>
&lt;/ul>
&lt;h3 id="方案选型">方案选型&lt;/h3>
&lt;ul>
&lt;li>成本&lt;/li>
&lt;li>设备依赖&lt;/li>
&lt;/ul>
&lt;h3 id="开源方案">开源方案&lt;/h3>
&lt;p>各开源SDN方案对比：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>flannel vxlan:
不具备网络隔离功能。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>OpenShift SDN:&lt;/p>
&lt;p>基于vxlan利用ovs-multienant可实现基于项目的网络隔离，和flannel vxlan相比，其使用的ovs-subnet插件，数据流场景大体一致，容器向外网发包也使用的NAT。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Calico:&lt;/p>
&lt;p>支持混合云，安全加密，
纯3层的路由实现保证了性能和低延迟
支持了网络隔离和ACL
但存在目前只支持TCP、UDP、ICMP、ICMPv6协议，四层协议不支持。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>OpenStack Neutron&lt;/p>
&lt;p>支持网络隔离
性能和低延迟 -- 需要优化
支持多租户
基于ML2支持混合云方案 -- kubernetes的支持需要第三方的kubestack项目
虚机迁移，IP可不变，容器迁移，IP不变 -- 需要开发
支持负载均衡LBaaS
支持精细级的ACL
API ?
可运维监控基本数据&lt;/p>
&lt;/li>
&lt;li>
&lt;p>OpenContrail&lt;/p>
&lt;p>&lt;strong>完全满足我们的网络需求&lt;/strong>, 值得深入研究&lt;/p>
&lt;p>Juniper开源的SDN &amp;amp; NFV方案&lt;/p>
&lt;p>已经集成支持OpenStack, VMware, Docker 和 Kubernetes.&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="各大厂商公开资料">各大厂商公开资料&lt;/h3>
&lt;ul>
&lt;li>网易蜂巢： VxLAN, 基于Openstack Neutron&lt;/li>
&lt;li>待补充...&lt;/li>
&lt;/ul></description></item></channel></rss>